<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="approval">
	
	<select id="logincheck" parameterType="String" resultType="com.approval.vo.Employee">
		select 
			
			EMPSEQ
			,EMPNAME
			,EMPGRADE
			,EMPID
			,EMPPW
			 
		from AEMPLOYEE 
		where EMPID = #{empid}	
	</select>
	
	
	<select id="getdetail" parameterType="integer" resultType="com.approval.vo.Document">
		SELECT DOMSEQ
		
				,EMPID
				,DOMSUB
				,DOMCONT
				,DOMREGDATE
				,APPROVALDATE
				,APPROVALEMP
				,APPROVALSTATUS  
				
		FROM ADOCUMENT
		WHERE DOMSEQ = #{dOMSEQ}
	
	</select>
	
		
	<insert id="write" parameterType="com.approval.vo.Document">
		insert into ADOCUMENT(
			                    DOMSEQ
			                    ,EMPID
			                    ,DOMSUB
			                    ,DOMCONT
			                    ,DOMREGDATE
			                    ,APPROVALSTATUS
			                    )
		values(
				(select nvl(Max(DOMSEQ),0)+1 from ADOCUMENT)
				,#{EMPID}
				,#{DOMSUB}
				,#{DOMCONT}
				,sysdate,
				'임시저장'
              )		
	</insert>
	
	
	
	<select id="list" parameterType="hashmap" resultType="com.approval.vo.DocEmpLine">
		select
			DOMSEQ				
			,EMPID			
			,DOMSUB			
			,DOMCONT			
			,DOMREGDATE		
			,APPROVALDATE		
			,APPROVALEMP		
			,APPROVALSTATUS	
			,EMPSEQ			
			,EMPNAME		
			,EMPGRADE	
				
		From (select 				
					ADOCUMENT.DOMSEQ				
					,ADOCUMENT.EMPID			
					,ADOCUMENT.DOMSUB			
					,ADOCUMENT.DOMCONT			
					,ADOCUMENT.DOMREGDATE		
					,ADOCUMENT.APPROVALDATE		
					,ADOCUMENT.APPROVALEMP		
					,ADOCUMENT.APPROVALSTATUS	
					,AEMPLOYEE.EMPSEQ			
					,AEMPLOYEE.EMPNAME		
					,AEMPLOYEE.EMPGRADE	
									
				FROM ADOCUMENT left join AEMPLOYEE
				ON ADOCUMENT.EMPID=AEMPLOYEE.EMPID
				WHERE  1=1 
                
                <if test="EMPGRADE == '사원'">
                    and  ADOCUMENT.EMPID = #{EMPID}
                </if>
                
                <if test="EMPGRADE == '대리'">
                    and ADOCUMENT.EMPID = #{EMPID}                     	
                </if>
                
                <if test="EMPGRADE == '과장'">
                    and  ADOCUMENT.APPROVALSTATUS ='결재대기'             	  
                </if>
                
                <if test="EMPGRADE == '부장'">
                    and  ADOCUMENT.APPROVALSTATUS ='결재중'
                </if>
                
                
			)	
				
				
				
				<!-- ADOCUMENT.EMPID = #{EMPID} -->
			  
			 
			 
			 
			 <!-- 리스트 완성후 검색은 해야됨 -->
		<!-- 	 where 1=1
			
		<if test="serchtype == 'EMPNAME' ">
			and EMPNAME like '%' || #{serchtext} || '%'
		</if>
			
		<if test="serchtype == 'DOMSUB' ">
			and DOMSUB like '%' || #{serchtext} || '%'			
		</if>
		
		<if test="serchtype == 'APPROVALEMP' ">
			and APPROVALEMP like '%' || #{serchtext} || '%'			
		</if>	
			
		<if test="stdate != null and stdate != '' ">
			and to_date(DOMREGDATE,'yyyy.MM.dd') between #{stdate} and #{endate}
			and to_char(DOMREGDATE,'yyyy-MM-dd') >= #{stdate}
			and to_char(DOMREGDATE,'yyyy-MM-dd') <![CDATA[<=]]> #{endate} 
		</if> -->	
					
			
	</select>
	
	<update id="approval.update" parameterType="com.approval.vo.Document">
		
		update ADOCUMENT 
		set 
		
		<if test=" APPROVALSTATUS == '임시저장' ">
			APPROVALSTATUS =  '결재대기'
		</if>
		
		<if test=" APPROVALSTATUS == '결재대기' ">
			APPROVALSTATUS =  '결재중'
		</if>
		
		<if test=" APPROVALSTATUS == '결재중' ">
			APPROVALSTATUS =  '결재완료'
		</if>
				
		where DOMSEQ = #{DOMSEQ}
		
		
	</update>
	
	
	
	
</mapper>	